<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RRtR - Hypothesis</title>
  <link rel="icon" href="./img/favicon-16x16.png" type="image/png">

  <link rel="stylesheet" href="./css/head.css">
  <link rel="stylesheet" href="css/bayes-base.css">
  <link rel="stylesheet" href="css/bayes-layout.css">
  <link rel="stylesheet" href="css/bayes-components.css">
  <link rel="stylesheet" href="css/utils.css">
  <!-- Vue 3 (CDN) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>

<div id="app" class="wrap" v-if="hypJson">
  <div class="header-row">
    <a href="index.html" class="logo-link">
      <img src="./img/favicon-32x32.png" alt="Logo" class="logo-img">
    </a>
    <span class="header-title">{{ hypJson.title }} (<a :href="'stats.html?hyp=' + (hypJson.name || '')">Statistics</a>)</span>
  </div>

  <div class="lead" v-html="formatNewline(hypJson.intro)"></div>

  <details class="help-text">
    <summary class="btn">Explanation of Bayes - optional read</summary>
    <p class="lead">
      <b>Abstract explanation:</b> State the apriori probability of the hypothesis/question. This is your "gut feeling" about the hypothesis before considering any evidence.
      Let's say you think the apriori probability is 0%. That means you, regardless of the evidence, believe the hypothesis is impossible.
      Or, if you specify 100%, you believe the hypothesis is certain to be true, regardless of the evidence. These are the two extremes
      that must be avoided if one considers oneself open to evidence! You can specify any value, but ChatGPT says 5% means 'very skeptical'
      and consequently 95% means 'very confident'. The default is 50%, which means you are neutral and have no prior bias about the hypothesis.
    </p>
    <p class="lead">
      <b>Example:</b> After entering the apriori probability, you can add evidence. Let's assume an example hypothesis: "Unicorns exist". We can then think of
      an evidence such as "I found a long straight & twisted horn". We must now specify two probabilities: 1) The probability of this evidence if
      the hypothesis is true, and 2) the probability of this evidence if the hypothesis is false. You do this by imagining that the hypotheis is
      true and then ask yourself: "Unicorns exist, then how likely is it that I would find such a horn?" and then you do the same
      for the case where the hypothesis is false: "Unicorns do not exist, then how likely is it that I would find such a horn?" Let's try it out:
    </p>
    <ul>
      <li>
        P(E<sub>i</sub> | H): The probability of the evidence if unicorn exists. We can say that the probability of such a horn is 80%,
        since we don't know if unicorns tends to lose their horns.
      </li>
      <li>
        P(E<sub>i</sub> | Â¬H): The probability of the evidence if unicorns do not exist. We can say that the probability of such a horn is 79%,
        since it is likely that such a horn could be found in nature (from a narwhal perhaps?) or maybe it's fake?
      </li>
    </ul>
    <p class="lead">
      Once you have entered the apriori/initial probability and at least one piece of evidence, the result will be calculated. The result will
      update as you add or change evidence. The result is probability of the hypothesis given the <b>all</b> evidence. In our example, if
      we choose 1% as the apriori probability, and the two probabilities above, the result will be 1,01% - a slight increase in the probability.
      Test some values below, and see the result yourself!
    </p>
  </details>


  <!-- Topp: apriori + posterior -->
  <div class="card heading">
    <div class="row-fixed">
      <div>
        <label>Your inital "gut feeling" <span class="hint">(0â€“100&nbsp;%)</span></label>
        <!-- Apriori -->
        <input
          class="input-apriori"
          type="number" min="0" max="100" step="any" inputmode="decimal"
          :value="priorPct"
          @keydown="blockNonNumeric"
          @input="onPriorInput"
        />
      </div>
      <div>
        <label>The result</label>
        <div :class="backgroundClass(posterior*100)" class="posterior">{{ posteriorPctText }}</div>
      </div>
      <div class="right">
        <button class="btn" @click="resetAll">Reset evidences</button>
      </div>
    </div>
  </div>

  <!-- Evidence-list -->
  <div>
    <div class="row" style="justify-content:space-between; margin-bottom:6px">
      <strong>Evidences ({{ hypJson.evidence.length }} available)</strong>
      <button class="btn" @click="addEvidence">Show next evidence</button>
    </div>

    <div v-for="(ev, idx) in evidences" :key="ev.id" class="card evidence" :class="backgroundClassEv(idx)">
      <div class="row-fixed-2col">
        <h3 class="evidence-heading">{{ hypJson.evidence[idx].head }}</h3>

        <div class="row-right">
          <div class="evidence-count">
            {{ idx + 1 }}/{{ hypJson.evidence.length }}
          </div>
          <button
            class="btn"
            title="Remove"
            v-if="idx === evidences.length - 1"
            @click="removeEvidence(idx)"
          >
            Remove
          </button>
        </div>
      </div>
      <div>
        <b>Summary:</b> {{ hypJson.evidence[idx].short }}
      </div>
      <div>
        <b>Category:</b> {{ hypJson.evidence[idx].category }}
      </div>
      <details class="details-block" style="margin: 6px 0;">
        <summary class="btn small">More info to explain the evidence better</summary>
        <!-- Detaljer -->
        <div style="margin-top: 6px;">
          <div v-html="formatNewline(hypJson.evidence[idx].details)"></div>
        </div>
        <!-- Referanser -->
        <div v-if="hypJson.evidence[idx].references && hypJson.evidence[idx].references.length" style="margin-top: 8px;">
          <strong>References:</strong>
          <ul>
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].references" :key="refIdx">
              <div v-html="ref"></div>
            </li>
          </ul>
        </div>
        <!-- Bible ref -->
        <div v-if="hypJson.evidence[idx].bible?.length" style="margin-top: 8px;">
          <strong>Bible references:</strong>
          <ul class="ref-list">
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].bible" :key="refIdx">
              <details class="ref-item">
                <summary>
                  <span class="chev">â–¶</span>
                  <span v-html="ref.summary"></span>
                </summary>
                <div class="ref-text" v-html="ref.text"></div>
              </details>
            </li>
          </ul>
        </div>
        <!-- Quran ref -->
        <div v-if="hypJson.evidence[idx].quran?.length" style="margin-top: 8px;">
          <strong>Qur'an references:</strong>
          <ul class="ref-list">
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].quran" :key="refIdx">
              <details class="ref-item">
                <summary>
                  <span class="chev">â–¶</span>
                  <span v-html="ref.summary"></span>
                </summary>
                <div class="ref-text" v-html="ref.text"></div>
              </details>
            </li>
          </ul>
        </div>
        <!-- Ancient ref -->
        <div v-if="hypJson.evidence[idx].ancient?.length" style="margin-top: 8px;">
          <strong>Ancient references:</strong>
          <ul class="ref-list">
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].ancient" :key="refIdx">
              <details class="ref-item">
                <summary>
                  <span class="chev">â–¶</span>
                  <span v-html="ref.summary"></span>
                </summary>
                <div class="ref-text">Year: {{ ref.year }}</div>
                <div class="ref-text">Author: {{ ref.author }}</div>
                <div class="ref-text" v-html="makeRefIntoTextWithLink(ref.url)"></div>
                <div class="ref-text" v-html="ref.text"></div>
              </details>
            </li>
          </ul>
        </div>
        <!-- Modern ref -->
        <div v-if="hypJson.evidence[idx].modern?.length" style="margin-top: 8px;">
          <strong>Modern references:</strong>
          <ul class="ref-list">
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].modern" :key="refIdx">
              <details class="ref-item">
                <summary>
                  <span class="chev">â–¶</span>
                  <span v-html="ref.summary"></span>
                </summary>
                <div class="ref-text">Year: {{ ref.year }}</div>
                <div class="ref-text" v-html="makeRefIntoTextWithLink(ref.url)"></div>
              </details>
            </li>
          </ul>
        </div>



      </details>
      <div class="row-fixed">
        <div>
          <label style="font-size: 0.8em;">Imagine '{{ hypJson.title }}' is <b>true</b>. How likely is the evidence "{{ hypJson.evidence[idx].head }}"? (0â€“100)</label>
          <input
            class="input-number"
            type="number" min="0" max="100" step="any" inputmode="numeric"
            :value="ev.pehPct"
            @keydown="blockNonNumeric"
            @input="onEvInput($event, ev, 'pehPct')"
            @change="checkAutoAppendEvidence"
          />
        </div>
        <div>
          <label style="font-size: 0.8em;">Imagine '{{ hypJson.title }}' is <b>false</b>. How likely is the evidence "{{ hypJson.evidence[idx].head }}"? (0â€“100)</label>
          <input
            class="input-number"
            type="number" min="0" max="100" step="any" inputmode="numeric"
            :value="ev.penhPct"
            @keydown="blockNonNumeric"
            @input="onEvInput($event, ev, 'penhPct')"
            @change="checkAutoAppendEvidence"
          />
        </div>
        <!-- ðŸ†• Tredje input-felt: vekt -->
        <div>
          <label style="font-size: 0.8em;">Importance of evidence</label>
          <select
            class="input-weight"
            v-model.number="ev.weight"
            @change="ev.weight === 0 && checkAutoAppendEvidence()"
            style="width: 140px;"
            title="How strongly this evidence should count"
          >
            <option :value="0">disregard</option>
            <option :value="25">some</option>
            <option :value="50">normal</option>
            <option :value="75">extra</option>
            <option :value="100">double</option>
          </select>
        </div>
      </div>
    </div>

    <div class="err" v-if="errorMsg">{{ errorMsg }}</div>
  </div>

  <div class="row-fixed">
    <button class="btn btn-primary" :disabled="evidences.length <= 1" @click="startPublish">Share results</button>
    <button class="btn btn-primary" @click="openUrlNewTab('stats.html?hyp=' + hypJson.name)">Statistics</button>
    <button class="btn" @click="addEvidence">Show next evidence</button>
  </div>


  <!-- Denomination modal -->
  <dialog ref="denomDialog" class="modal">
    <h2>Select your denomination</h2>

    <div style="margin:8px 0 12px;">
      <select class="input-weight" v-model="denomination" style="width:100%;">
        <option value="" disabled>Selectâ€¦</option>
        <option v-for="d in denominations" :key="d" :value="d">{{ d }}</option>
      </select>
    </div>

    <div class="row right">
      <button class="btn" @click="cancelDenomination">Cancel</button>
      <button class="btn btn-primary" :disabled="!denomination" @click="confirmDenomination">
        Continue
      </button>
    </div>
  </dialog>

  <!-- Results modal (add denomination display if you want) -->
  <dialog ref="resultsDialog" class="modal">
    <h2>{{ publishJson.title }}</h2>

    <div class="row" style="justify-content:space-between; margin: 8px 0 6px;">
      <div><strong>Denomination:</strong> {{ publishJson.denomination || 'â€”' }}</div>
      <div><strong>Inital Gut-feeling:</strong> {{ fmtPct(publishJson.aprioriPct) }}</div>
      <div><strong>Result:</strong> {{ fmtPct(publishJson.posteriorPct) }}</div>
    </div>

    <table class="table">
      <thead>
      <tr>
        <th>Evidence</th>
        <th>P(E|H)</th>
        <th>P(E|Â¬H)</th>
        <th>Importance</th>
      </tr>
      </thead>
      <tbody>
      <tr v-for="(ev,idx) in publishJson.evidence" :key="ev.id" :class="backgroundClassEv(idx)">
        <td>{{ ev.head }}</td>
        <td class="num">{{ fmtPct(ev.pehPct) }}</td>
        <td class="num">{{ fmtPct(ev.penhPct) }}</td>
        <td class="num">{{ ev.weight }}</td>
      </tr>
      </tbody>
    </table>

    <!-- hvis knapper dersom publishJson.evidence har minst Ã©n evidens -->
    <div v-if="publishJson.evidence && publishJson.evidence.length" style="margin-top: 12px;">
      <div class="row right" style="margin-top: 10px; gap: 6px;">
        <button class="btn btn-primary" @click="aiPrompt" title="After clicking on the button, paste result (CTRL/CMD-V) into AI to get advice">Copy AI-prompt</button>
        <button class="btn btn-primary" @click="handlePublish" :class="{ 'btn-published': publishedUrl }">{{ publishButtonText }}</button>
        <button class="btn" @click="closePublish">Close</button>
      </div>
      <div>
        <p v-if="publishStatus" class="status-text">{{ publishStatus }}</p>
      </div>
    </div>
    <div v-else style="margin-top: 12px;">
      <div class="row right" style="margin-top: 10px; gap: 6px;">
        <button class="btn" @click="closePublish">Close</button>
      </div>
  </dialog>
</div>

<!-- App-kode (ES-modul) -->
<script type="module" src="./js/app.js"></script>
</body>
</html>
