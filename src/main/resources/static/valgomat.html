<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Capologia</title>
  <link rel="icon" href="./img/favicon-16x16.png" type="image/png">

  <!-- Global CSS -->
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/layout.css">
  <link rel="stylesheet" href="./css/components.css">
  <link rel="stylesheet" href="./css/utilities.css">
  <link rel="stylesheet" href="./css/theme.css">
  <!-- Vue 3 (CDN) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>

<div id="app" class="wrap" v-if="hypJson">
  <h1>{{ hypJson.title }}</h1>
  <p class="lead">{{ hypJson.intro }}</p>

  <details class="help-text">
    <summary class="btn">Explanation of Bayes</summary>
    <p class="lead">
      State the apriori probability of the hypothesis/question. This is your "gut feeling" about the hypothesis before considering any evidence.
      Let's say you think the apriori probability is 0%. That means you, regardless of the evidence, believe the hypothesis is impossible.
      Or, if you specify 100%, you believe the hypothesis is certain to be true, regardless of the evidence. These are the two extremes
      that must be avoided if one considers oneself open to evidence! You can specify any value, but ChatGPT says 5% means 'very skeptical'
      and consequently 95% means 'very confident'. The default is 50%, which means you are neutral and have no prior opinion about the hypothesis.
    </p>
    <p class="lead">
      After entering the apriori probability, you can add evidence. For each piece of evidence, you must specify two probabilities. Let's assume
      an example hypothesis: "Unicorns exist". We can then think of an evidence such as "I found a long straight & twisted horn".
    </p>
    <ul>
      <li>
        P(E<sub>i</sub> | H): The probability of the evidence if unicorn exists. We can say that the probability of such a horn is 80%,
        since we don't know if unicorns tends to lose their horns.
      </li>
      <li>
        P(E<sub>i</sub> | Â¬H): The probability of the evidence if unicorns do not exist. We can say that the probability of such a horn is 79%,
        since it is likely that such a horn could be found in nature, or that it is a fake horn.
      </li>
    </ul>
    <p class="lead">
      Once you have entered the apriori/initial probability and at least one piece of evidence, the result will be calculated. The result will
      update as you add or change evidence. The result is probability of the hypothesis given the <b>all</b> evidence. In our example, if
      we choose 1% as the apriori probability, and the two probabilities above, the result will be 1,01% - a slight increase in the probability.
      Test some values below, and see the result yourself!
    </p>
  </details>


  <!-- Topp: apriori + posterior -->
  <div class="card heading">
    <div class="row-fixed">
      <div>
        <label>Your inital "gut feeling" <span class="hint">(0â€“100&nbsp;%)</span></label>
        <!-- Apriori -->
        <input
          class="input apriori-big"
          type="number" min="0" max="100" step="any" inputmode="decimal"
          :value="priorPct"
          @keydown="blockNonNumeric"
          @input="onPriorInput"
        />
      </div>
      <div>
        <label>The result</label>
        <div :class="backgroundClass(posterior*100)" class="posterior">{{ posteriorPctText }}</div>
      </div>
      <div class="right">
        <button class="btn ghost" @click="resetAll">Reset evidences</button>
      </div>
    </div>
  </div>

  <!-- Evidence-list -->
  <div>
    <div class="row" style="justify-content:space-between; margin-bottom:6px">
      <strong>Evidences ({{ hypJson.evidence.length }} available)</strong>
      <button class="btn" @click="addEvidence">Show next evidence</button>
    </div>

    <div v-for="(ev, idx) in evidences" :key="ev.id" class="card evidence" :class="backgroundClassEv(idx)">
      <div class="row-fixed">
        <div>
          <h3 class="evidence-heading">{{ hypJson.evidence[idx].id }}</h3>
        </div>
        <div class="row" style="justify-content:flex-end" v-if="idx === evidences.length - 1">
          <button class="btn ghost" title="Remove" @click="removeEvidence(idx)">Remove</button>
        </div>
      </div>
      <div>
        <b>Summary:</b> {{ hypJson.evidence[idx].short }}
      </div>
      <details class="details-block" style="margin: 6px 0;">
        <summary class="btn small">More info</summary>
        <!-- Detaljer -->
        <div style="margin-top: 6px;">
          {{ hypJson.evidence[idx].details }}
        </div>
        <!-- Referanser -->
        <div v-if="hypJson.evidence[idx].references && hypJson.evidence[idx].references.length" style="margin-top: 8px;">
          <strong>References:</strong>
          <ul>
            <li v-for="(ref, refIdx) in hypJson.evidence[idx].references" :key="refIdx">
              <a :href="extractUrl(ref)" target="_blank" rel="noopener">{{ ref }}</a>
            </li>
          </ul>
        </div>
      </details>
      <div class="row-fixed">
        <div>
          <label style="font-size: 0.6em;">Probability of evidence if hypothesis is <b>true</b> (0â€“100)</label>
          <input
            type="number" min="0" max="100" step="any" inputmode="numeric"
            :value="ev.pehPct"
            @keydown="blockNonNumeric"
            @input="onEvInput($event, ev, 'pehPct')"
            @change="checkAutoAppendEvidence"
          />
        </div>
        <div>
          <label style="font-size: 0.6em;">Probability of evidence if hypothesis is <b>false</b> (0â€“100)</label>
          <input
            type="number" min="0" max="100" step="any" inputmode="numeric"
            :value="ev.penhPct"
            @keydown="blockNonNumeric"
            @input="onEvInput($event, ev, 'penhPct')"
            @change="checkAutoAppendEvidence"
          />
        </div>
        <!-- ðŸ†• Tredje input-felt: vekt -->
        <div>
          <label style="font-size: 0.6em;">Weight</label>
          <select
            class="weight"
            :value="ev.weight"
            @change="onEvInput($event, ev, 'weight')"
            style="width: 140px;"
            title="How strongly this evidence should count"
          >
            <option :value="0">disregard</option>
            <option :value="25">some</option>
            <option :value="50">normal</option>
            <option :value="75">extra</option>
            <option :value="100">double</option>
          </select>
        </div>
      </div>
    </div>

    <div class="err" v-if="errorMsg">{{ errorMsg }}</div>
  </div>

  <!-- CTA -->
  <div class="row-fixed">
    <button class="btn btn--primary btn--lg" @click="openPublish">
      Publish your results
    </button>
  </div>

  <!-- Modal -->
  <dialog ref="resultsDialog" class="modal">
    <h2>Review your results</h2>
    <pre class="json">{{ publishJson }}</pre>
    <div class="row right">
      <button class="btn" @click="copyPublish">Copy JSON</button>
      <button class="btn btn--primary" @click="closePublish">Close</button>
    </div>
  </dialog>
</div>

<!-- App-kode (ES-modul) -->
<script type="module" src="./js/app.js"></script>
</body>
</html>
